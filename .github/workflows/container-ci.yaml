name: Container CI for ghcr.io

on:
  release:
    types:
      - published

jobs:
  build_and_publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Container building
        run: |
          docker login --username davionchai --password ${{ secrets.GHCR_ALL_ACCESS }} ghcr.io
          echo "Creating snowflake-was container with tags: [$GITHUB_REF_NAME, $GITHUB_SHA]"
          docker build -t ghcr.io/davionchai/snowflake-was:latest -t ghcr.io/davionchai/snowflake-was:$GITHUB_REF_NAME -t ghcr.io/davionchai/snowflake-was:$GITHUB_SHA --file ./build/Dockerfile .
          docker push ghcr.io/davionchai/snowflake-was --all-tags
